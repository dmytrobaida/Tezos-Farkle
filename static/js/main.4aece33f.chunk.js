(this["webpackJsonptezos-farkle"]=this["webpackJsonptezos-farkle"]||[]).push([[0],{102:function(e,t){},104:function(e,t){},128:function(e,t){},132:function(e,t){},133:function(e,t){},154:function(e,t){},156:function(e,t){},181:function(e,t,n){"use strict";n.r(t);var r,a,c,i,s,o,u,l,d,h,p,b,f,j,m,x,v,O,g,w=n(0),y=n.n(w),k=n(41),G=n.n(k),z=n(27),C=n(38),N=n(8),D=n(9),A=n(2),P=n(18),S=n(3),T=n.n(S),E=n(10),F=n(20),B=n(7),M=n(24),R=n.n(M),I=new R.a.Math.RandomDataGenerator,J=function(){function e(t,n,r){var a=this;Object(P.a)(this,e),this.sprite=void 0,this.sprite=t.physics.add.sprite(n,r,"dice"),this.sprite.setInteractive(new R.a.Geom.Rectangle(0,0,100,100),R.a.Geom.Rectangle.Contains),this.sprite.on("pointerover",(function(){a.sprite.alpha=.5})),this.sprite.on("pointerout",(function(){a.sprite.alpha=1}))}return Object(F.a)(e,[{key:"throwDice",value:function(e){var t=I.shuffle([0,1,2,3,4,5,0,1,2,3,4,5,0,1,2,3,4]);t.push(e-1),this.sprite.anims.remove("roll"),this.sprite.anims.create({key:"roll",frames:this.sprite.anims.generateFrameNumbers("dice",{start:0,end:5,frames:t}),frameRate:15}),this.sprite.play("roll")}},{key:"getSprite",value:function(){return this.sprite}}]),e}(),L=function(){function e(){Object(P.a)(this,e),this.dices=[]}return Object(F.a)(e,[{key:"start",value:function(e){var t=this;return new Promise((function(n){return new R.a.Game({type:R.a.AUTO,parent:e,width:"100",height:"100",physics:{default:"arcade",arcade:{gravity:{y:0}}},scene:{preload:function(){this.load.spritesheet("dice","./images/dice.png",{frameWidth:100,frameHeight:100})},create:function(){var e=function(e){var t=e.sys.canvas,n=t.width,r=t.height;return[new J(e,n/2-250,r/2),new J(e,0,0),new J(e,0,0),new J(e,0,0),new J(e,0,0),new J(e,0,0)]}(this);e.forEach((function(n,r){t.dices.push(n),0!==r&&R.a.Display.Align.In.RightCenter(n.sprite,e[r-1].sprite,100)})),n()}}})}))}},{key:"throwDices",value:function(e){this.dices.forEach((function(t,n){return t.throwDice(e[n])}))}},{key:"setDiceValues",value:function(e){for(var t=0;t<e.length;t++){var n;null===(n=this.dices[t])||void 0===n||n.sprite.setFrame(0===e[t]?0:e[t]-1)}}}]),e}(),$=function(){function e(t){Object(P.a)(this,e),this.getApi=t,this.game=new L,this.allGames=[],this.currentGame=null,Object(B.d)(this,{},{autoBind:!0})}return Object(F.a)(e,[{key:"startGame",value:function(){var e=Object(E.a)(T.a.mark((function e(t){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.game.start(t);case 2:null!=this.currentGame&&this.game.setDiceValues(this.currentGame.currentPlayerDices.map((function(e){return e.toNumber()})));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"throwDices",value:function(){var e=Object(E.a)(T.a.mark((function e(t){var n,r,a=this;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(n=this.getApi())||void 0===n?void 0:n.throwDices(t);case 2:r=e.sent,Object(B.g)((function(){a.game.throwDices(r.currentPlayerDices.map((function(e){return e.toNumber()}))),a.currentGame=r}));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"endMove",value:function(){var e=Object(E.a)(T.a.mark((function e(t){var n,r,a=this;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(n=this.getApi())||void 0===n?void 0:n.endMove(t);case 2:r=e.sent,Object(B.g)((function(){a.currentGame=r}));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadGames",value:function(){var e=Object(E.a)(T.a.mark((function e(){var t,n,r=this;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=this.getApi())||void 0===t?void 0:t.loadAllGames();case 2:n=e.sent,Object(B.g)((function(){null!=n&&(r.allGames=n)}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"joinGame",value:function(){var e=Object(E.a)(T.a.mark((function e(t){var n,r,a=this;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(n=this.getApi())||void 0===n?void 0:n.startNewGame(t);case 2:r=e.sent,Object(B.g)((function(){a.currentGame=r}));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createNewGame",value:function(){var e=Object(E.a)(T.a.mark((function e(){var t;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=this.getApi())||void 0===t?void 0:t.createNewGame();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),W=n(55),H="KT19ARHPtcBsgBs55obUSE2FzMXZ7QcQNoBz",Q=function(){function e(t){Object(P.a)(this,e),this.tezosToolkit=t}return Object(F.a)(e,[{key:"createNewGame",value:function(){var e=Object(E.a)(T.a.mark((function e(){var t,n,r;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,this.tezosToolkit.wallet.at(H);case 3:return t=e.sent,e.next=6,t.methods.createNewGame().send();case 6:return n=e.sent,e.next=9,n.confirmation();case 9:return e.next=11,t.storage();case 11:return r=e.sent,e.abrupt("return",r.activeGames);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadAllGames",value:function(){var e=Object(E.a)(T.a.mark((function e(){var t,n,r,a=this;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,this.tezosToolkit.wallet.at(H);case 3:return t=e.sent,e.next=6,t.storage();case 6:return n=e.sent,e.next=9,Promise.all(n.activeGames.map(function(){var e=Object(E.a)(T.a.mark((function e(t){var n,r;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.tezosToolkit.wallet.at(t);case 2:return n=e.sent,e.next=5,n.storage();case 5:return r=e.sent,e.abrupt("return",Object(C.a)(Object(C.a)({},r),{},{address:t}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 9:return r=e.sent,e.abrupt("return",r);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"startNewGame",value:function(){var e=Object(E.a)(T.a.mark((function e(t){var n,r,a;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.tezosToolkit.wallet.at(t);case 2:return n=e.sent,e.next=5,n.methods.startGame().send();case 5:return r=e.sent,e.next=8,r.confirmation();case 8:return e.next=10,n.storage();case 10:return a=e.sent,e.abrupt("return",a);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"throwDices",value:function(){var e=Object(E.a)(T.a.mark((function e(t){var n,r,a,c,i=arguments;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:[],e.next=3,this.tezosToolkit.wallet.at(t);case 3:return r=e.sent,e.next=6,r.methods.throwDices(n).send();case 6:return a=e.sent,e.next=9,a.confirmation();case 9:return e.next=11,r.storage();case 11:return c=e.sent,e.abrupt("return",c);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"endMove",value:function(){var e=Object(E.a)(T.a.mark((function e(t){var n,r,a;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.tezosToolkit.wallet.at(t);case 2:return n=e.sent,e.next=5,n.methods.endMove().send();case 5:return r=e.sent,e.next=8,r.confirmation();case 8:return e.next=10,n.storage();case 10:return a=e.sent,e.abrupt("return",a);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),U=new(function(){function e(){var t=this;Object(P.a)(this,e),this.address="",this.balance="",this.connected=!1,this.api=void 0,this.getApi=function(){return t.api},Object(B.d)(this,{},{autoBind:!0})}return Object(F.a)(e,[{key:"connect",value:function(){var e=Object(E.a)(T.a.mark((function e(){var t,n,r,a,c=this;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.connected){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,W.a.isAvailable();case 4:e.sent||alert("Temple Wallet not installed"),t=new W.a("Farkle"),e.next=12;break;case 10:e.next=14;break;case 12:return e.next=14,t.connect("granadanet");case 14:return n=t.toTezos(),e.next=17,n.wallet.pkh();case 17:return r=e.sent,e.next=20,n.tz.getBalance(r);case 20:a=e.sent,Object(B.g)((function(){c.address=r,c.balance=a.toString(),c.connected=t.connected,c.api=new Q(n)}));case 22:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}()),V=new $(U.getApi),Y=function e(){Object(P.a)(this,e),this.tezosStore=U,this.gameStore=V},K=Object(w.createContext)(new Y),X=function(){return Object(w.useContext)(K)},Z=Y,q=n(23),_={0:"Created",1:"PlayerJoined",2:"Started",3:"Finished"},ee=D.b.div(r||(r=Object(N.a)(["\n  background-color: #282c34;\n  min-height: 100vh;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: flex-start;\n  font-size: calc(10px + 2vmin);\n  color: white;\n"]))),te=D.b.div(a||(a=Object(N.a)(["\n  cursor: pointer;\n  font-size: 14px;\n  margin-right: 10px;\n\n  :hover {\n    color: red;\n  }\n"]))),ne=D.b.div(c||(c=Object(N.a)(["\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: flex-start;\n  width: 100vw;\n  height: 12vh;\n  background-color: red;\n  padding-left: 50px;\n  padding-right: 50px;\n"]))),re=D.b.div(i||(i=Object(N.a)(["\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: center;\n  width: 100vw;\n  height: 88vh;\n  background-color: blue;\n"]))),ae=D.b.table(s||(s=Object(N.a)(["\n  border-collapse: collapse;\n\n  th {\n    border: 1px solid #dddddd;\n    text-align: left;\n    padding: 8px;\n  }\n"]))),ce=n(1),ie=Object(q.a)((function(){var e=X(),t=e.tezosStore,n=e.gameStore,r=Object(A.g)();Object(w.useEffect)((function(){n.loadGames()}),[n]);var a=Object(w.useCallback)(function(){var e=Object(E.a)(T.a.mark((function e(t){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.joinGame(t);case 2:r("/game",{state:{gameAddress:t}});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[n,r]),c=Object(w.useCallback)(Object(E.a)(T.a.mark((function e(){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.createNewGame();case 2:return e.next=4,n.loadGames();case 4:case"end":return e.stop()}}),e)}))),[n]);return Object(ce.jsxs)(ee,{children:[Object(ce.jsxs)(ne,{children:[Object(ce.jsxs)(te,{children:["Address: ",t.address]}),Object(ce.jsxs)(te,{children:["Balance: ",t.balance]})]}),Object(ce.jsx)(re,{children:Object(ce.jsxs)(ae,{children:[Object(ce.jsx)("thead",{children:Object(ce.jsxs)("tr",{children:[Object(ce.jsx)("th",{children:"Contract address"}),Object(ce.jsx)("th",{children:"Creator address"}),Object(ce.jsx)("th",{children:"Status"}),Object(ce.jsx)("th",{children:Object(ce.jsx)("button",{onClick:c,children:"Create new"})})]})}),Object(ce.jsx)("tbody",{children:n.allGames.map((function(e,t){return Object(ce.jsxs)("tr",{children:[Object(ce.jsx)("td",{children:e.address}),Object(ce.jsx)("td",{children:e.creator}),Object(ce.jsx)("td",{children:_[e.state.toNumber()]}),Object(ce.jsx)("td",{children:Object(ce.jsx)("button",{onClick:function(){return a(e.address)},children:"Join game"})})]},t)}))})]})})]})})),se=D.b.div(o||(o=Object(N.a)(["\n  line-height: 50px;\n  padding: 0 15px 0 15px;\n  color: black;\n  border-radius: 5px;\n  border: 1px solid black;\n  width: auto;\n  background-color: red;\n  text-align: center;\n  cursor: pointer;\n\n  :hover {\n    color: white;\n  }\n"]))),oe=Object(q.a)((function(e){var t=e.children,n=X().tezosStore,r=Object(A.f)();return n.connected?t:Object(ce.jsx)(A.a,{to:"/",state:{from:r}})})),ue=D.b.div(u||(u=Object(N.a)(["\n  position: relative;\n  width: 100%;\n  height: 100%;\n"]))),le="gameWindow",de=function(e){var t=e.onStart;return Object(w.useEffect)((function(){t(le)}),[t]),Object(ce.jsx)(ue,{id:le})},he=D.b.div(l||(l=Object(N.a)(["\n  position: relative;\n  background-color: #282c34;\n  min-height: 100vh;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  font-size: calc(10px + 2vmin);\n  color: #cdcdcd;\n"]))),pe=D.b.div(d||(d=Object(N.a)(["\n  position: relative;\n  width: calc(80vw - 250px);\n  height: 76vh;\n  border: 5px solid #cdcdcd;\n  background-color: grey;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n"]))),be=D.b.div(h||(h=Object(N.a)(["\n  position: absolute;\n  top: 50%;\n  transform: translateY(-50%);\n  background-color: black;\n  border: 5px solid #cdcdcd;\n  width: 250px;\n  height: 400px;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n"]))),fe=Object(D.b)(be)(p||(p=Object(N.a)(["\n  left: 10px;\n"]))),je=Object(D.b)(be)(b||(b=Object(N.a)(["\n  right: 10px;\n"]))),me=D.b.div(f||(f=Object(N.a)(["\n  font-family: monospace;\n  font-size: 25px;\n  background-color: rgba($color: #fff, $alpha: 0.2);\n  padding-left: 10px;\n  padding-right: 10px;\n  color: #cdcdcd;\n  box-sizing: border-box;\n  width: 100%;\n  text-align: center;\n  text-transform: uppercase;\n"]))),xe=D.b.div(j||(j=Object(N.a)(["\n  font-family: monospace;\n  font-size: 20px;\n  background-color: rgba($color: #fff, $alpha: 0.2);\n  padding-left: 10px;\n  padding-right: 10px;\n  color: #cdcdcd;\n  box-sizing: border-box;\n  width: 100%;\n"]))),ve=D.b.span(m||(m=Object(N.a)(["\n  color: #cdcdcd;\n  font-size: 40px;\n  font-family: monospace;\n  margin-top: 5px;\n"]))),Oe=D.b.div(x||(x=Object(N.a)(["\n  position: absolute;\n  bottom: 10px;\n  display: flex;\n  justify-content: space-between;\n"]))),ge=Object(D.b)(se)(v||(v=Object(N.a)(["\n  margin-left: 10px;\n  margin-right: 10px;\n  text-transform: uppercase;\n"]))),we={1:"la-dice-one",2:"la-dice-two",3:"la-dice-three",4:"la-dice-four",5:"la-dice-five",6:"la-dice-six"},ye=Object(q.a)((function(){var e,t,n,r,a=X(),c=a.gameStore,i=a.tezosStore,s=(Object(A.f)().state||{}).gameAddress,o=Object(w.useMemo)((function(){return e=i.address,null==(t=c.currentGame)?null:e===t.player1?{me:{points:t.player1Points},other:{points:t.player2Points}}:{me:{points:t.player2Points},other:{points:t.player1Points}};var e,t}),[i,c]);return null==s?Object(ce.jsx)(A.a,{to:"/main",replace:!0}):Object(ce.jsxs)(he,{children:[Object(ce.jsx)(pe,{children:Object(ce.jsx)(de,{onStart:c.startGame.bind(c)})}),Object(ce.jsxs)(fe,{children:[Object(ce.jsx)(me,{children:"You"}),Object(ce.jsxs)(xe,{children:["Total: ",null===o||void 0===o?void 0:o.me.points.toNumber()," points"]}),Object(ce.jsxs)(xe,{children:["Current: ",null===(e=c.currentGame)||void 0===e?void 0:e.movePoints.toNumber()," points"]}),Object(ce.jsx)(ve,{children:null===(t=c.currentGame)||void 0===t?void 0:t.currentPlayerLeavedDices.map((function(e,t){return Object(ce.jsx)("i",{className:"las "+we[e.toNumber()]},t)}))})]}),Object(ce.jsxs)(je,{children:[Object(ce.jsx)(me,{children:"Guest"}),Object(ce.jsxs)(xe,{children:["Total: ",null===o||void 0===o?void 0:o.other.points.toNumber()," points"]}),Object(ce.jsxs)(xe,{children:["Current: ",null===(n=c.currentGame)||void 0===n?void 0:n.movePoints.toNumber()," points"]}),Object(ce.jsx)(ve,{children:null===(r=c.currentGame)||void 0===r?void 0:r.currentPlayerLeavedDices.map((function(e,t){return Object(ce.jsx)("i",{className:"las "+we[e.toNumber()]},t)}))})]}),Object(ce.jsxs)(Oe,{children:[Object(ce.jsx)(ge,{onClick:function(){return c.throwDices(s)},children:"Roll dices"}),Object(ce.jsx)(ge,{onClick:function(){return c.endMove(s)},children:"End move"})]})]})})),ke=D.b.div(O||(O=Object(N.a)(["\n  position: relative;\n  background-color: #282c34;\n  min-height: 100vh;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  font-size: calc(10px + 2vmin);\n  color: white;\n"]))),Ge=Object(q.a)((function(){var e=X().tezosStore,t=Object(A.f)(),n=Object(A.g)(),r=Object(w.useCallback)(Object(E.a)(T.a.mark((function r(){var a,c,i;return T.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.connect();case 2:i=(null===(a=t.state)||void 0===a||null===(c=a.from)||void 0===c?void 0:c.pathname)||"/main",n(i,{replace:!0});case 4:case"end":return r.stop()}}),r)}))),[e,t,n]);return Object(ce.jsx)(ke,{children:Object(ce.jsx)(se,{onClick:r,children:"Connect"})})})),ze=[{path:"/",element:y.a.createElement(Ge)},{path:"/game",element:y.a.createElement(oe,{children:y.a.createElement(ye)})},{path:"/main",element:y.a.createElement(oe,{children:y.a.createElement(ie)})}],Ce=Object(D.a)(g||(g=Object(N.a)(["\n  body {\n    margin: 0;\n    font-family: 'Roboto', monospace;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n  }\n\n  * {\n    box-sizing: border-box;\n  }\n"]))),Ne=new Z,De=function(){return Object(ce.jsxs)(ce.Fragment,{children:[Object(ce.jsx)(Ce,{}),Object(ce.jsx)(K.Provider,{value:Ne,children:Object(ce.jsx)(A.d,{children:ze.map((function(e,t){return Object(ce.jsx)(A.b,Object(C.a)({},e),t)}))})})]})},Ae=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,184)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))};G.a.render(Object(ce.jsx)(y.a.StrictMode,{children:Object(ce.jsx)(z.a,{children:Object(ce.jsx)(De,{})})}),document.getElementById("root")),Ae()}},[[181,1,2]]]);
//# sourceMappingURL=main.4aece33f.chunk.js.map